<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8"/>
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0"/>
    <title>Pagina Inicial</title>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/gh/iconoir-icons/iconoir@main/css/iconoir.css"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
          crossorigin="anonymous">
    <link rel="stylesheet"
          type="text/css"
          href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.css">
    <link rel="stylesheet"
          href="./global.css"/>
</head>

<body>
<div th:insert="~{fragments/sidebar :: sidebar('home')}"></div>

<div class="w-100">
    <div th:insert="~{fragments/header :: header}"></div>

    <div class="page-content p-3">
        <div class=" d-flex justify-content-center align-items-center"
             style="height: 60%; margin-right: 100px;">
            <div class=" w-50 d-flex flex-column justify-content-center align-items-center m-3 rounded shadow"
                 style="height:80%; ">
                <p style="font-size: 20px;">Quantidade de propriedades por status</p>
                <div id="chart"
                     class=""
                     style="height:75%; width:80%"></div>
            </div>

            <div class=" w-50 m-3"
                 style="height:80%;">
                <div class="p-2 rounded shadow"
                     style="width: 100%; height: 100%">
                    <iframe id="mapaIframe"
                            class="rounded"
                            width="100%"
                            height="100%"
                            frameborder="0"
                            scrolling="no"
                            marginheight="0"
                            marginwidth="0"
                            src="https://maps.google.com/maps?width=100%25&amp;height=100%25&amp;hl=en&amp;q=toledo&amp;t=&amp;z=14&amp;ie=UTF8&amp;iwloc=B&amp;output=embed">
                    </iframe>
                </div>
            </div>
        </div>
        <div class=" d-flex justify-content-center align-items-center"
             style="height: 40%; margin-right: 100px;">
            <div class=" w-50 d-flex flex-column justify-content-center align-items-center m-3 rounded shadow"
                 style="height:100%; ">
                <p style="font-size: 20px;">Top 5 tecnologias mais produzidas</p>
                <div id="chart2"
                     class=""
                     style="height:75%; width:100%"></div>
            </div>
            <div class=" w-50 d-flex justify-content-center align-items-center m-3 rounded shadow"
                 style="height:100%; ">
                <table class="table">
                    <thead>
                    <tr>
                        <th>Ultimas propriedades cadastradas</th>
                        <th></th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="propriedade : ${propriedades}">

                        <td th:text="${propriedade.nomePropriedade}"></td>
                        <td class="d-flex justify-content-end">
                            <button
                                    class="btn btn-primary"
                                    th:attr="onclick=|verMapa(${propriedade.latitude}, ${propriedade.longitude})|"
                            >
                                Ver no mapa
                            </button>
                        </td>

                    </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript"
            charset="utf8"
            src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script th:inline="javascript">
        var options = {
            series: [
                [[${type1Count}]],
                [[${type2Count}]],
                [[${type3Count}]]
            ],
            chart: {
                type: 'donut',
            },
            colors: ['#32CD32', '#e2c31d', '#FF0000'],
            labels: ['Ativo', 'Ativos em contemplação', 'Desistentes'],
            responsive: [{
                breakpoint: 480,
                options: {
                    chart: {
                        width: 500
                    },
                    legend: {
                        position: 'bottom'
                    }
                }
            }]
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

        // Converta o modelo 'topTec' para um array JavaScript
        var topTec = /*[[${topTec}]]*/ [];

        var categories = topTec.map(function (item) {
            return item.nome;
        });
        var values = topTec.map(function (item) {
            return item.qtd;
        });

        var options = {
            series: [{
                data: values
            }],
            chart: {
                height: 250,
                type: 'bar',
                events: {
                    click: function (chart, w, e) {
                        // console.log(chart, w, e)
                    }
                }
            },
            colors: ['#546E7A', '#FF9800', '#141f29'],
            plotOptions: {
                bar: {
                    columnWidth: '45%',
                    distributed: true,
                }
            },
            dataLabels: {
                enabled: false
            },
            legend: {
                show: false
            },
            xaxis: {
                categories: categories,
                labels: {
                    style: {
                        colors: ['#546E7A', '#FF9800', '#141f29'],
                        fontSize: '12px'
                    }
                }
            }
        };

        var chart = new ApexCharts(document.querySelector("#chart2"), options);
        chart.render();
    </script>
    <script>
        function verMapa(latitude, longitude) {
            console.log(latitude)
            var iframe = document.getElementById("mapaIframe");
            var url = `https://maps.google.com/maps?width=100%&height=300&hl=en&q=${latitude},${longitude}&t=&z=13&ie=UTF8&iwloc=B&output=embed`;
            iframe.src = url;
        }
    </script>
</div>
</body>
</html>
